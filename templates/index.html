<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Stats Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>YouTube Stats Dashboard</h1>
        <button id="refresh">Refresh Data</button>

        <!-- Summary Cards -->
        <div class="summary">
            <div class="card">
                <h3>Total Subscribers</h3>
                <p id="totalSubscribers">Loading...</p>
            </div>
            <div class="card">
                <h3>Total Views</h3>
                <p id="totalViews">Loading...</p>
            </div>
            <div class="card">
                <h3>Total Videos</h3>
                <p id="totalVideos">Loading...</p>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div id="updateStatus" class="hidden">
            <p id="updateMessage">Idle</p>
            <div class="progress-bar">
                <div id="updateProgressBar" class="progress"></div>
            </div>
        </div>

        <!-- Table Data -->
        <table>
            <thead>
                <tr>
                    <th>Channel</th>
                    <th>Subscribers</th>
                    <th>Views</th>
                    <th>Videos</th>
                </tr>
            </thead>
            <tbody id="channelData">
                <tr><td colspan="4">Loading...</td></tr>
            </tbody>
        </table>

    </div>

    <script>
    function loadData() {
        $.get("/data", function(data) {
            $("#channelData").empty();
            $("#totalSubscribers").text(data.totalSubscribers.toLocaleString());
            $("#totalViews").text(data.totalViews.toLocaleString());
            $("#totalVideos").text(data.totalVideos.toLocaleString());

            if (!data.channels.length) {
                $("#channelData").append("<tr><td colspan='4'>No data available.</td></tr>");
            } else {
                data.channels.forEach(channel => {
                    $("#channelData").append(`<tr>
                        <td>${channel["Title"]}</td>
                        <td>${channel["Subscribers"]}</td>
                        <td>${channel["Views"]}</td>
                        <td>${channel["Videos"]}</td>
                    </tr>`);
                });
            }
        });
    }

    function checkUpdateStatus() {
        $.get("/update_status", function(status) {
            $("#updateMessage").text(status.message);
            $("#updateProgressBar").css("width", status.progress + "%");

            if (status.updating) {
                $("#updateStatus").removeClass("hidden");
                $("#refresh").prop("disabled", true);
            } else {
                $("#updateStatus").addClass("hidden");
                $("#refresh").prop("disabled", false);
            }
        });
    }

    $("#refresh").click(function() {
        $.post("/update", function(response) {
            alert(response.message);
            checkUpdateStatus();
        });
    });

    $(document).ready(loadData);
    setInterval(checkUpdateStatus, 2000);
</script>

</body>
</html>
